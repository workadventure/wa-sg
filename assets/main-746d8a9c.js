import{b as d,g as E,P as R}from"./init-5da4ed0e.js";console.info("Script started successfully");let u;const c={EN:{TRIGGER:"Press SPACE or touch here to ",DOC:"read the document.",VIDEO:"watch the video.",WEBSITE:"open the website.",OBJECT:"discover the hidden object.",UNDEFINED:"The URL is not defined."},FR:{TRIGGER:"Appuyez sur ESPACE ou touchez ici pour ",DOC:"lire le document.",VIDEO:"regarder la vidéo.",WEBSITE:"ouvrir le site web.",OBJECT:"découvrir l'objet caché.",UNDEFINED:"L'URL n'est pas définie."}},m=[{AREA:"gfl-step1-1",URL:"to-config"},{AREA:"gfl-step1-2",URL:"to-config"},{AREA:"gfl-step2-1",URL:"to-config"},{AREA:"gfl-step2-2",URL:"to-config"},{AREA:"gfl-step3-1",URL:"to-config"},{AREA:"gfl-step3-2",URL:"to-config"},{AREA:"gfl-step3-3",URL:"to-config"},{AREA:"gfl-feedback",URL:"to-config"},{AREA:"gfl-quiz",URL:"to-config"},{AREA:"gfl-basics-step1-1",URL:"to-config"},{AREA:"gfl-basics-step1-2",URL:"to-config"},{AREA:"gfl-basics-step1-3",URL:"to-config"},{AREA:"gfl-basics-step2-1",URL:"to-config"},{AREA:"gfl-basics-step2-2",URL:"to-config"},{AREA:"gfl-basics-step3-1",URL:"to-config"},{AREA:"gfl-basics-step4-1",URL:"to-config"},{AREA:"gfl-basics-step5-1",URL:"to-config"},{AREA:"gfl-basics-step5-2",URL:"to-config"},{AREA:"gfl-basics-step5-3",URL:"to-config"},{AREA:"gfl-basics-feedback",URL:"to-config"},{AREA:"gfl-basics-quiz",URL:"to-config"},{AREA:"replayInformation",MESSAGE:{EN:`Welcome to the GFL cinema.
You can watch the replays in one of the 4 rooms upstairs.`,FR:`Bienvenue dans le cinéma GFL.
Vous pouvez aller visionner les retransmissions dans une des 4 salles à l'étage.`}}];let o;WA.onInit().then(()=>{console.log("Player tags: ",WA.player.tags);const e=WA.room.mapURL;u=e.substring(0,e.lastIndexOf("/")),o=(WA.player.language?WA.player.language:navigator.language).startsWith("fr")?"FR":"EN",WA.ui.actionBar.addButton({id:"help-btn",type:"action",imageSrc:u+"/help.svg",toolTip:o==="FR"?"Comment utiliser WorkAdventure":"How to use WorkAdventure",callback:()=>{WA.ui.modal.openModal({title:"Help",src:"https://workadventu.re",allowApi:!1,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}),WA.ui.actionBar.addButton({id:"plan-btn",type:"action",imageSrc:u+"/map-plan.svg",toolTip:o==="FR"?"Ouvrir le plan":"Open the plan",callback:()=>{WA.ui.modal.openModal({title:"Plan",src:"https://workadventu.re",allowApi:!1,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}),p("Room1"),p("Room2"),p("Room3"),p("Room4"),d().then(async()=>{console.log("Scripting API Extra ready");const i=await s();for(const[n,r]of i.entries()){let A,g="WEBSITE",a="",l=m.find(f=>f.AREA===n);l&&l.URL?(a=c[o].TRIGGER,a+=c[o][r]):l&&l.MESSAGE?(g="POPUP",a=l.MESSAGE[o]):(g="SCAVENGER",a=c[o].TRIGGER,a+=c[o][r]),A={area:n,interaction:g,message:a},W(A)}async function s(){return new Promise(async n=>{const r=new Map,A=[],g=await E();for(const a of g.values())if(a.type==="objectgroup"){for(const l of a.objects)if(l.type==="area"||l.class==="area"){const f=new R(l.properties);f.getBoolean("translate")===!0&&r.set(l.name,f.getString("contentType"))}}else a.type==="tilelayer"&&a.name.startsWith("lang/")&&A.push(a.name);b(A),n(r)})}}).catch(i=>console.error(i))}).catch(e=>console.error(e));function p(e){WA.room.area.onEnter(e).subscribe(()=>{WA.room.showLayer(`doorOpen${e}`),WA.room.hideLayer(`doorClosed${e}`)}),WA.room.area.onLeave(e).subscribe(()=>{WA.room.showLayer(`doorClosed${e}`),WA.room.hideLayer(`doorOpen${e}`)})}function b(e){e.forEach(t=>WA.room.hideLayer(t)),e.filter(t=>t.includes(o+"/")).forEach(t=>WA.room.showLayer(t))}function W(e){let t,i,s,n;WA.room.area.onEnter(e.area).subscribe(()=>{if(e.interaction==="WEBSITE"){const r=WA.state.loadVariable(`${e.area}-${o}-config`);WA.player.tags.includes("admin")&&WA.ui.actionBar.addButton({id:"configure-btn",label:o==="FR"?"Configurer":"Configure",callback:()=>{n=WA.ui.modal.openModal({title:o==="FR"?"Page d'administration":"Administration page",src:u+`/administration/index.html?area=${e.area}`,allowApi:!0,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}),i=WA.ui.displayActionMessage({message:r?e.message:o==="FR"?c.FR.UNDEFINED:c.EN.UNDEFINED,callback:()=>WA.nav.openCoWebSite(r)})}else e.interaction==="SCAVENGER"?i=WA.ui.displayActionMessage({message:e.message,callback:async()=>{n=WA.ui.modal.openModal({title:o==="FR"?"Vous avez trouvé un nouvel objet caché !":"You found a new hidden object!",src:u+`/scavenger/index.html?lang=${o}&area=${e.area}`,allowApi:!0,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}):e.interaction==="POPUP"&&(s=WA.ui.openPopup(e.area+"Popup",e.message,[{label:o==="FR"?"Fermer":"Close",className:"normal",callback:()=>{s==null||s.close(),s=null}}]))}),WA.room.area.onLeave(e.area).subscribe(()=>{WA.player.tags.includes("admin")&&WA.ui.actionBar.removeButton("configure-btn"),i==null||i.remove(),i=null,t==null||t.close(),t=null,n&&(WA.ui.modal.closeModal(),n=null),s==null||s.close(),s=null})}
