import{b as W,g as E,P as b}from"./init-5da4ed0e.js";console.info("Script started successfully");let o,u,f;const g={EN:{TRIGGER:"Press SPACE or touch here to ",DOC:"read the document.",VIDEO:"watch the video.",WEBSITE:"open the website.",OBJECT:"discover the hidden object."},FR:{TRIGGER:"Appuyez sur ESPACE ou touchez ici pour ",DOC:"lire le document.",VIDEO:"regarder la vidéo.",WEBSITE:"ouvrir le site web.",OBJECT:"découvrir l'objet caché."}},h=[{AREA:"gfl-step1-1",URL:"to-config"},{AREA:"gfl-step1-2",URL:"to-config"},{AREA:"gfl-step2-1",URL:"to-config"},{AREA:"gfl-step2-2",URL:"to-config"},{AREA:"gfl-step3-1",URL:"to-config"},{AREA:"gfl-step3-2",URL:"to-config"},{AREA:"gfl-step3-3",URL:"to-config"},{AREA:"replayInformation",MESSAGE:{EN:`Welcome to the GFL cinema.
You can watch the replays in one of the 4 rooms upstairs.`,FR:`Bienvenue dans le cinéma GFL.
Vous pouvez aller visionner les retransmissions dans une des 4 salles à l'étage.`}}];let t;WA.onInit().then(()=>{console.log("Player tags: ",WA.player.tags),t=(WA.player.language?WA.player.language:navigator.language).startsWith("fr")?"FR":"EN",WA.ui.actionBar.addButton({id:"help-btn",type:"action",imageSrc:"https://svgur.com/i/10Sh.svg",toolTip:"Help",callback:()=>{u=WA.state.lnk_stand_en,WA.nav.openCoWebSite(u)}}),WA.ui.actionBar.addButton({id:"mapoverview-btn",type:"action",imageSrc:"https://hugoaverty.github.io/map-overview/img/map.svg",toolTip:"Map overview",callback:()=>{WA.nav.openCoWebSite("Mapoverview.svg")}}),WA.room.area.onEnter("standZone").subscribe(()=>{o||(WA.player.language=="fr-FR"?o=WA.ui.openPopup("popupStand",WA.state.txt_popup_stand_fr,[{label:WA.state.cta_popup_stand_fr,className:"primary",callback:()=>{u=WA.state.lnk_stand_fr,WA.nav.openCoWebSite(u),o==null||o.close(),o=null}}]):o=WA.ui.openPopup("popupStand",WA.state.txt_popup_stand_en,[{label:WA.state.cta_popup_stand_en,className:"primary",callback:()=>{u=WA.state.lnk_stand_en,WA.nav.openCoWebSite(u),o==null||o.close(),o=null}}]))}),WA.room.area.onLeave("standZone").subscribe(()=>{o==null||o.close(),o=null}),d("Room1"),d("Room2"),d("Room3"),d("Room4"),W().then(async()=>{console.log("Scripting API Extra ready");const a=WA.room.mapURL;f=a.substring(0,a.lastIndexOf("/"));const i=await s();for(const[r,c]of i.entries()){let p,m="WEBSITE",n="",l=h.find(A=>A.AREA===r);l&&l.URL?(n=g[t].TRIGGER,n+=g[t][c]):l&&l.MESSAGE?(m="POPUP",n=l.MESSAGE[t]):(m="SCAVENGER",n=g[t].TRIGGER,n+=g[t][c]),p={area:r,interaction:m,message:n},y(p)}async function s(){return new Promise(async r=>{const c=new Map,p=[],m=await E();for(const n of m.values())if(n.type==="objectgroup"){for(const l of n.objects)if(l.type==="area"||l.class==="area"){const A=new b(l.properties);A.getBoolean("translate")===!0&&c.set(l.name,A.getString("contentType"))}}else n.type==="tilelayer"&&n.name.startsWith("lang/")&&p.push(n.name);R(p),r(c)})}}).catch(a=>console.error(a))}).catch(e=>console.error(e));function d(e){WA.room.area.onEnter(e).subscribe(()=>{WA.room.showLayer(`doorOpen${e}`),WA.room.hideLayer(`doorClosed${e}`)}),WA.room.area.onLeave(e).subscribe(()=>{WA.room.showLayer(`doorClosed${e}`),WA.room.hideLayer(`doorOpen${e}`)})}function R(e){e.forEach(a=>WA.room.hideLayer(a)),e.filter(a=>a.includes(t+"/")).forEach(a=>WA.room.showLayer(a))}function y(e){let a,i,s,r;WA.room.area.onEnter(e.area).subscribe(()=>{if(e.interaction==="WEBSITE"){const c=WA.state.loadVariable(`${e.area}-${t}-config`);WA.player.tags.includes("admin")&&WA.ui.actionBar.addButton({id:"configure-btn",label:t==="FR"?"Configurer":"Configure",callback:()=>{r=WA.ui.modal.openModal({title:t==="FR"?"Page d'administration":"Administration page",src:f+`/administration/index.html?area=${e.area}`,allowApi:!0,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}),i=WA.ui.displayActionMessage({message:e.message,callback:()=>WA.nav.openTab(c)})}else e.interaction==="SCAVENGER"?i=WA.ui.displayActionMessage({message:e.message,callback:async()=>{r=WA.ui.modal.openModal({title:t==="FR"?"Vous avez trouvé un nouvel objet caché !":"You found a new hidden object!",src:f+`/scavenger/index.html?lang=${t}&area=${e.area}`,allowApi:!0,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}):e.interaction==="POPUP"&&(s=WA.ui.openPopup(e.area+"Popup",e.message,[{label:t==="FR"?"Fermer":"Close",className:"normal",callback:()=>{s==null||s.close(),s=null}}]))}),WA.room.area.onLeave(e.area).subscribe(()=>{WA.player.tags.includes("admin")&&WA.ui.actionBar.removeButton("configure-btn"),i==null||i.remove(),i=null,a==null||a.close(),a=null,r&&(WA.ui.modal.closeModal(),r=null),s==null||s.close(),s=null})}
