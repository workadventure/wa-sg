import{b as d,g as R,P as E}from"./init-5da4ed0e.js";console.info("Script started successfully");let c;const r={EN:{TRIGGER:"Press SPACE or touch here to ",DOC:"read the document.",VIDEO:"watch the video.",WEBSITE:"open the website.",OBJECT:"discover the hidden object.",DIALOGUE:"talk with ",UNDEFINED:"The URL is not defined."},FR:{TRIGGER:"Appuyez sur ESPACE ou touchez ici pour ",DOC:"lire le document.",VIDEO:"regarder la vidéo.",WEBSITE:"ouvrir le site web.",OBJECT:"découvrir l'objet caché.",DIALOGUE:"parler avec ",UNDEFINED:"L'URL n'est pas définie."}},m=[{AREA:"gfl-step1-1",URL:"to-config"},{AREA:"gfl-step1-2",URL:"to-config"},{AREA:"gfl-step2-1",URL:"to-config"},{AREA:"gfl-step2-2",URL:"to-config"},{AREA:"gfl-step3-1",URL:"to-config"},{AREA:"gfl-step3-2",URL:"to-config"},{AREA:"gfl-step3-3",URL:"to-config"},{AREA:"gfl-feedback",URL:"to-config"},{AREA:"gfl-quiz",URL:"to-config"},{AREA:"gfl-basics-step1-1",URL:"to-config"},{AREA:"gfl-basics-step1-2",URL:"to-config"},{AREA:"gfl-basics-step1-3",URL:"to-config"},{AREA:"gfl-basics-step2-1",URL:"to-config"},{AREA:"gfl-basics-step2-2",URL:"to-config"},{AREA:"gfl-basics-step3-1",URL:"to-config"},{AREA:"gfl-basics-step4-1",URL:"to-config"},{AREA:"gfl-basics-step5-1",URL:"to-config"},{AREA:"gfl-basics-step5-2",URL:"to-config"},{AREA:"gfl-basics-step5-3",URL:"to-config"},{AREA:"gfl-basics-feedback",URL:"to-config"},{AREA:"gfl-basics-quiz",URL:"to-config"},{AREA:"Simone",NPC:"config-in-dialogue-box-website"},{AREA:"Lukas",NPC:"config-in-dialogue-box-website"},{AREA:"Victor",NPC:"config-in-dialogue-box-website"},{AREA:"Sarah",NPC:"config-in-dialogue-box-website"}];let o;WA.onInit().then(()=>{console.log("Player tags: ",WA.player.tags);const e=WA.room.mapURL;c=e.substring(0,e.lastIndexOf("/")),o=(WA.player.language?WA.player.language:navigator.language).startsWith("fr")?"FR":"EN",WA.ui.actionBar.addButton({id:"help-btn",type:"action",imageSrc:c+"/help.svg",toolTip:o==="FR"?"Comment utiliser WorkAdventure":"How to use WorkAdventure",callback:()=>{WA.ui.modal.openModal({title:"Help",src:c+"/Notice_Utilisateurs.pdf",allowApi:!1,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}),WA.ui.actionBar.addButton({id:"plan-btn",type:"action",imageSrc:c+"/map-plan.svg",toolTip:o==="FR"?"Ouvrir le plan":"Open the plan",callback:()=>{WA.ui.modal.openModal({title:"Plan",src:c+"/Repartition_GFL.pdf",allowApi:!1,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}),u("Room1"),u("Room2"),u("Room3"),u("Room4"),d().then(async()=>{console.log("Scripting API Extra ready");const t=await g();for(const[s,l]of t.entries()){let A,p="WEBSITE",a="",n=m.find(f=>f.AREA===s);n&&n.URL?(a=r[o].TRIGGER,a+=r[o][l]):n&&n.NPC?(p="NPC",a=r[o].TRIGGER,a+=r[o][l],a+=s+"."):(p="SCAVENGER",a=r[o].TRIGGER,a+=r[o][l]),A={area:s,interaction:p,message:a},W(A)}async function g(){return new Promise(async s=>{const l=new Map,A=[],p=await R();for(const a of p.values())if(a.type==="objectgroup"){for(const n of a.objects)if(n.type==="area"||n.class==="area"){const f=new E(n.properties);f.getBoolean("translate")===!0&&l.set(n.name,f.getString("contentType"))}}else a.type==="tilelayer"&&a.name.startsWith("lang/")&&A.push(a.name);b(A),s(l)})}}).catch(t=>console.error(t))}).catch(e=>console.error(e));function u(e){WA.room.area.onEnter(e).subscribe(()=>{WA.room.showLayer(`doorOpen${e}`),WA.room.hideLayer(`doorClosed${e}`)}),WA.room.area.onLeave(e).subscribe(()=>{WA.room.showLayer(`doorClosed${e}`),WA.room.hideLayer(`doorOpen${e}`)})}function b(e){e.forEach(i=>WA.room.hideLayer(i)),e.filter(i=>i.includes(o+"/")).forEach(i=>WA.room.showLayer(i))}function W(e){let i,t,g,s;WA.room.area.onEnter(e.area).subscribe(()=>{if(e.interaction==="WEBSITE"){const l=WA.state.loadVariable(`${e.area}-${o}-config`);WA.player.tags.includes("admin")&&WA.ui.actionBar.addButton({id:"configure-btn",label:o==="FR"?"Configurer":"Configure",callback:()=>{g=WA.ui.modal.openModal({title:o==="FR"?"Page d'administration":"Administration page",src:c+`/administration/index.html?area=${e.area}`,allowApi:!0,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}),t=WA.ui.displayActionMessage({message:l?e.message:o==="FR"?r.FR.UNDEFINED:r.EN.UNDEFINED,callback:()=>WA.nav.openCoWebSite(l)})}else e.interaction==="SCAVENGER"?t=WA.ui.displayActionMessage({message:e.message,callback:async()=>{g=WA.ui.modal.openModal({title:o==="FR"?"Vous avez trouvé un nouvel objet caché !":"You found a new hidden object!",src:c+`/scavenger/index.html?lang=${o}&area=${e.area}`,allowApi:!0,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}}):e.interaction==="NPC"&&(t=WA.ui.displayActionMessage({message:e.message,callback:async()=>{s=await WA.ui.website.open({url:c+`/dialogue-box/index.html?lang=${o}&name=${e.area}`,visible:!0,allowApi:!1,allowPolicy:"",position:{vertical:"bottom",horizontal:"middle"},size:{height:"120px",width:"650px"},margin:{bottom:"70px"}})}}))}),WA.room.area.onLeave(e.area).subscribe(()=>{WA.player.tags.includes("admin")&&WA.ui.actionBar.removeButton("configure-btn"),t==null||t.remove(),t=null,i==null||i.close(),i=null,g&&(WA.ui.modal.closeModal(),g=null),s==null||s.close(),s=null})}
